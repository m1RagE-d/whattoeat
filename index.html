<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šå¤©åƒä»€ä¹ˆï¼ŸVibe Coding 4.0</title>
    <style>
        :root {
            --primary: #4a90e2;
            --danger: #ff6b6b;
            --bg: #f4f6f9;
            --card: #ffffff;
            --text: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            background: var(--card);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 500px;
        }

        h1 { margin-top:0; margin-bottom: 20px; font-size: 1.6rem; text-align: center; color: #2c3e50; }

        .section {
            margin-bottom: 25px;
            padding: 15px;
            background: #fafafa;
            border-radius: 12px;
            border: 1px solid #eee;
        }

        .section-title {
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.95rem;
            color: #555;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }
        
        .section-subtitle {
            font-size: 0.75rem;
            font-weight: normal;
            color: #999;
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.85rem;
            background: #fff;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid #ddd;
            transition: all 0.2s;
            user-select: none;
        }

        label:hover { border-color: var(--primary); }

        /* éšè—åŸç”Ÿ checkbox */
        input[type="checkbox"] { display: none; }

        /* === è“è‰²ç³»ï¼šæƒ³åƒ (Positive) === */
        .positive-group label:hover { border-color: var(--primary); }
        .positive-group input:checked + span { color: var(--primary); font-weight: bold; }
        .positive-group label:has(input:checked) { border-color: var(--primary); background: #eef6ff; }

        /* === çº¢è‰²ç³»ï¼šä¸åƒ (Negative) === */
        .negative-group label:hover { border-color: var(--danger); }
        .negative-group input:checked + span { color: var(--danger); text-decoration: line-through; font-weight: bold; }
        .negative-group label:has(input:checked) { border-color: var(--danger); background: #fff0f0; }

        .result-box {
            margin: 20px 0;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #fff;
            border: 2px dashed #ddd;
            border-radius: 15px;
            text-align: center;
            padding: 15px;
            position: relative;
        }

        .food-name {
            font-size: 2.2rem;
            font-weight: 800;
            color: #2c3e50;
            margin: 5px 0;
            line-height: 1.2;
        }

        .food-tags {
            margin-top: 10px;
            font-size: 0.75rem;
        }
        
        .tag-pill {
            display: inline-block;
            background: #eee;
            padding: 3px 8px;
            border-radius: 4px;
            margin: 2px;
            color: #666;
        }

        .tag-pill.highlight { background: #eef6ff; color: var(--primary); border: 1px solid #b3d7ff; }
        .tag-pill.warn { background: #ffebeb; color: #d63031; }

        button.action-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 16px;
            font-size: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
            transition: transform 0.1s;
        }

        button.action-btn:active { transform: scale(0.98); }
        
        .count-hint { font-size: 0.8rem; color: #aaa; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ± ä»Šå¤©åƒä»€ä¹ˆ v4.0</h1>

    <div class="section positive-group">
        <span class="section-title">
            ğŸ˜‹ ä»Šå¤©æƒ³åƒç‚¹... 
            <span class="section-subtitle">å¯å¤šé€‰ï¼Œä¸é€‰é»˜è®¤å…¨éƒ¨</span>
        </span>
        <div class="tags-container">
            <label><input type="checkbox" value="ç±³é¥­"> <span>ç±³é¥­/é¥­ç±»</span></label>
            <label><input type="checkbox" value="é¢é£Ÿ"> <span>é¢/ç²‰</span></label>
            <label><input type="checkbox" value="æ—¥å¼"> <span>æ—¥å¼</span></label>
            <label><input type="checkbox" value="éŸ©å¼"> <span>éŸ©å¼</span></label>
            <label><input type="checkbox" value="æ±¤"> <span>å¸¦æ±¤çš„</span></label>
            <label><input type="checkbox" value="è‚‰"> <span>å¤§å£åƒè‚‰</span></label>
            <label><input type="checkbox" value="è½»é£Ÿ"> <span>å‡è„‚/è½»é£Ÿ</span></label>
            <label><input type="checkbox" value="è¾£"> <span>æ¥ç‚¹è¾£çš„</span></label>
        </div>
    </div>

    <div class="section negative-group">
        <span class="section-title">
            ğŸš« ç»å¯¹ä¸åƒ/å¿Œå£
            <span class="section-subtitle">ä¸€ç¥¨å¦å†³</span>
        </span>
        <div class="tags-container">
            <label><input type="checkbox" value="è¾£"> <span>è¾£</span></label>
            <label><input type="checkbox" value="å§œ"> <span>å§œ</span></label>
            <label><input type="checkbox" value="è’œ"> <span>è’œ</span></label>
            <label><input type="checkbox" value="è‘±"> <span>è‘±</span></label>
            <label><input type="checkbox" value="é¦™èœ"> <span>é¦™èœ</span></label>
            <label><input type="checkbox" value="æŠ˜è€³æ ¹"> <span>æŠ˜è€³æ ¹</span></label>
            <label><input type="checkbox" value="å†…è„"> <span>å†…è„</span></label>
            <label><input type="checkbox" value="æµ·é²œ"> <span>æµ·é²œ/é±¼</span></label>
            <label><input type="checkbox" value="é¸¡è›‹"> <span>é¸¡è›‹</span></label>
            <label><input type="checkbox" value="éº¸è´¨"> <span>éº¸è´¨(é¢/åŒ…)</span></label>
            <label><input type="checkbox" value="ç™½äººé¥­"> <span>ç™½äººé¥­</span></label>
            <label><input type="checkbox" value="ç”Ÿé£Ÿ"> <span>ç”Ÿé£Ÿ</span></label>
        </div>
    </div>

    <div class="result-box">
        <div id="resultName" class="food-name" style="font-size:1.5rem; color:#ccc;">ç­‰å¾…...</div>
        <div id="resultTags" class="food-tags"></div>
    </div>

    <button class="action-btn" onclick="rollFood()">ğŸ² å¼€å§‹éšæœº</button>
    <div class="count-hint" id="countHint"></div>
</div>

<script>
    // === æ•°æ®åº“åŒºåŸŸ ===
    const menu = [
        // --- æ—¥å¼ ---
        { name: "æ‹›ç‰Œç‰›ä¸¼é¥­", tags: ["æ—¥å¼", "ç±³é¥­", "ç‰›ç¾Šè‚‰", "æ´‹è‘±", "è‚‰"] },
        { name: "æ—¥å¼å’–å–±çŒªæ’é¥­", tags: ["æ—¥å¼", "ç±³é¥­", "çŒªè‚‰", "ç‚¸", "è‚‰", "éº¸è´¨"] },
        { name: "æ¸©æ³‰è›‹è‘±èŠ±ç‰›ä¸¼", tags: ["æ—¥å¼", "ç±³é¥­", "ç‰›ç¾Šè‚‰", "é¸¡è›‹", "è‘±", "è‚‰"] },
        { name: "é³—é±¼é¥­", tags: ["æ—¥å¼", "ç±³é¥­", "æµ·é²œ", "ç”œå£", "è‚‰"] },
        { name: "ç…§çƒ§é¸¡æ’é¥­", tags: ["æ—¥å¼", "ç±³é¥­", "é¸¡è‚‰", "ç”œå£", "è‚‰"] },
        { name: "ä¸‰æ–‡é±¼åˆºèº«/å¯¿å¸", tags: ["æ—¥å¼", "ç±³é¥­", "æµ·é²œ", "ç”Ÿé£Ÿ", "å†·é£Ÿ", "è½»é£Ÿ"] },
        { name: "åŠ å·å·", tags: ["æ—¥å¼", "ç±³é¥­", "æµ·é²œ", "å†·é£Ÿ", "æ²™æ‹‰é…±", "é»„ç“œ"] },
        { name: "è±šéª¨æ‹‰é¢", tags: ["æ—¥å¼", "é¢é£Ÿ", "çŒªè‚‰", "æ±¤", "è‘±", "éº¸è´¨", "è‚‰"] },
        { name: "æ—¥å¼å¯¿å–œé”…", tags: ["æ—¥å¼", "æ±¤", "ç‰›ç¾Šè‚‰", "è±†è…", "å¤§ç™½èœ", "è‚‰"] },

        // --- éŸ©å¼ ---
        { name: "çŸ³é”…æ‹Œé¥­", tags: ["éŸ©å¼", "ç±³é¥­", "é¸¡è›‹", "è¾£", "èƒ¡èåœ", "è±†èŠ½"] },
        { name: "éŸ©å¼æ³¡èœæ±¤", tags: ["éŸ©å¼", "æ±¤", "è¾£", "çŒªè‚‰", "è±†è…", "é…¸"] },
        { name: "éŸ©å¼å¤§é…±æ±¤", tags: ["éŸ©å¼", "æ±¤", "è±†è…", "æµ·é²œ", "è‘±", "è’œ"] },
        { name: "è¾£ç™½èœäº”èŠ±è‚‰ç‚’é¥­", tags: ["éŸ©å¼", "ç±³é¥­", "çŒªè‚‰", "è¾£", "è’œ", "è‚‰"] },
        { name: "éŸ©å¼å†·é¢", tags: ["éŸ©å¼", "é¢é£Ÿ", "è¾£", "é¸¡è›‹", "å†·é£Ÿ", "éº¸è´¨"] },
        { name: "éŸ©å¼ç‰›è‚‰æ±¤é¥­", tags: ["éŸ©å¼", "æ±¤", "ç±³é¥­", "ç‰›ç¾Šè‚‰", "æ¸…æ·¡", "è‘±", "è‚‰"] },

        // --- ä¸­å¼ç®€é¤ ---
        { name: "ç•ªèŒ„ç‚’è›‹ç›–é¥­", tags: ["é¸¡è›‹", "ç±³é¥­", "å®¶å¸¸èœ", "æ¸…æ·¡"] },
        { name: "é’æ¤’è‚‰ä¸ç›–é¥­", tags: ["çŒªè‚‰", "ç±³é¥­", "è¾£", "å®¶å¸¸èœ", "è‚‰"] },
        { name: "é±¼é¦™è‚‰ä¸", tags: ["çŒªè‚‰", "ç±³é¥­", "è¾£", "ç¬‹", "æœ¨è€³", "è’œ", "è‚‰"] },
        { name: "å®«ä¿é¸¡ä¸", tags: ["é¸¡è‚‰", "ç±³é¥­", "è¾£", "èŠ±ç”Ÿ", "è‘±", "è‚‰"] },
        { name: "åœŸè±†ç‰›è…©", tags: ["ç‰›ç¾Šè‚‰", "ç±³é¥­", "å®¶å¸¸èœ", "è‚‰"] },
        { name: "çº¢çƒ§æ’éª¨é¥­", tags: ["çŒªè‚‰", "ç±³é¥­", "å®¶å¸¸èœ", "ç”œå£", "è‚‰"] },
        
        // --- é¢é£Ÿ/ç²‰ ---
        { name: "å…°å·æ‹‰é¢", tags: ["ç‰›ç¾Šè‚‰", "é¢é£Ÿ", "é¦™èœ", "æ¸…æ·¡", "è‘±", "æ±¤", "éº¸è´¨", "è‚‰"] },
        { name: "é‡åº†å°é¢", tags: ["é¢é£Ÿ", "è¾£", "é‡å£å‘³", "èŠ±æ¤’", "è‘±", "ç¢³æ°´ç‚¸å¼¹", "éº¸è´¨"] },
        { name: "çº¢çƒ§ç‰›è‚‰é¢", tags: ["ç‰›ç¾Šè‚‰", "é¢é£Ÿ", "è¾£", "é¦™èœ", "æ±¤", "éº¸è´¨", "è‚‰"] },
        
        // --- ç‰¹è‰² ---
        { name: "é…¸èœé±¼", tags: ["æµ·é²œ", "é±¼", "ç±³é¥­", "è¾£", "å§œ", "èŠ±æ¤’", "é‡å£å‘³", "æ±¤", "è‚‰"] },
        { name: "æ¯›è¡€æ—º", tags: ["å†…è„", "é¸­è¡€", "è¾£", "é‡å£å‘³", "åˆé¤è‚‰", "è‚‰"] },
        { name: "çŒªè‚šé¸¡", tags: ["é¸¡è‚‰", "å†…è„", "æ¸…æ·¡", "æ±¤", "èƒ¡æ¤’", "è‚‰"] },
        
        // --- ç²¤å¼ ---
        { name: "å¹²ç‚’ç‰›æ²³", tags: ["ç‰›ç¾Šè‚‰", "é¢é£Ÿ", "è‘±", "èŠ½èœ", "è‚‰"] },
        { name: "é²œè™¾äº‘åé¢", tags: ["æµ·é²œ", "é¢é£Ÿ", "æ¸…æ·¡", "æ±¤", "éº¸è´¨", "è‚‰"] },
        { name: "çš®è›‹ç˜¦è‚‰ç²¥", tags: ["çŒªè‚‰", "ç±³é¥­", "æ¸…æ·¡", "å§œ", "è‘±", "æ±¤"] },

        // --- è¥¿å¼/å¿«é¤ ---
        { name: "éº¦å½“åŠ³åŒå±‚å‰å£«å ¡", tags: ["ç‰›ç¾Šè‚‰", "å¿«é¤", "çƒ­é‡ç‚¸å¼¹", "éº¸è´¨", "è‚‰"] },
        { name: "è‚¯å¾·åŸºé¦™è¾£é¸¡è…¿å ¡", tags: ["é¸¡è‚‰", "å¿«é¤", "è¾£", "ç‚¸", "éº¸è´¨", "è‚‰"] },
        { name: "èµ›ç™¾å‘³ç«é¸¡èƒ¸ä¸‰æ˜æ²»", tags: ["ç™½äººé¥­", "å†·é£Ÿ", "é¸¡è‚‰", "é¢åŒ…", "éº¸è´¨", "è½»é£Ÿ"] },
        { name: "è½»é£Ÿæ³¢å¥‡é¥­", tags: ["ç™½äººé¥­", "æµ·é²œ", "å†·é£Ÿ", "ç±³é¥­", "ç”Ÿé£Ÿ", "è½»é£Ÿ"] },
        { name: "é¸¡èƒ¸è‚‰å‡¯æ’’æ²™æ‹‰", tags: ["ç™½äººé¥­", "è‰", "å†·é£Ÿ", "é¸¡è‚‰", "è½»é£Ÿ"] },
    ];

    let lastDishName = "";

    function rollFood() {
        const resultName = document.getElementById('resultName');
        const resultTags = document.getElementById('resultTags');
        const countHint = document.getElementById('countHint');

        // 1. è·å–æ­£å‘æ¡ä»¶ (Array)
        const cravingCheckboxes = document.querySelectorAll('.positive-group input:checked');
        const cravings = Array.from(cravingCheckboxes).map(cb => cb.value);

        // 2. è·å–è´Ÿå‘æ¡ä»¶ (Array)
        const bannedCheckboxes = document.querySelectorAll('.negative-group input:checked');
        const bannedTags = Array.from(bannedCheckboxes).map(cb => cb.value);

        // 3. è¿‡æ»¤é€»è¾‘
        const safeList = menu.filter(dish => {
            const dishTags = dish.tags;
            
            // A. å¿Œå£æ£€æŸ¥ (ä¸€ç¥¨å¦å†³)
            const hasBanned = dishTags.some(tag => bannedTags.includes(tag));
            if (hasBanned) return false;
            // å…³è”å¿Œå£ï¼šä¸åƒéº¸è´¨ -> ä¹Ÿå°±ä¸èƒ½åƒé¢é£Ÿ
            if (bannedTags.includes("éº¸è´¨") && dishTags.includes("é¢é£Ÿ")) return false;

            // B. æƒ³åƒæ£€æŸ¥ (OR é€»è¾‘)
            // å¦‚æœç”¨æˆ·ä»€ä¹ˆéƒ½æ²¡é€‰ (length === 0)ï¼Œåˆ™é»˜è®¤æ‰€æœ‰èœéƒ½ç¬¦åˆæ­£å‘æ¡ä»¶
            if (cravings.length === 0) return true;

            // å¦‚æœç”¨æˆ·é€‰äº†ï¼Œåªè¦èœå“åŒ…å«"ä»»æ„ä¸€ä¸ª"æƒ³è¦çš„æ ‡ç­¾ï¼Œå°±ä¿ç•™
            // æ¯”å¦‚é€‰äº† ["éŸ©å¼", "è‚‰"]ï¼Œé‚£ä¹ˆ"éŸ©å¼ç´ èœ"æˆ–"ä¸­å¼çº¢çƒ§è‚‰"éƒ½ç®—è¿‡
            const matchCraving = dishTags.some(tag => cravings.includes(tag));
            return matchCraving;
        });

        // 4. æ›´æ–°UIä¸æŠ½å–
        countHint.innerText = `å½“å‰ç¬¦åˆæ¡ä»¶çš„æœ‰ ${safeList.length} é“èœ`;

        if (safeList.length === 0) {
            resultName.style.color = "#aaa";
            resultName.innerText = "æ²¡æƒ³å‡ºæ¥...";
            
            // æ™ºèƒ½æç¤º
            if (cravings.includes("è¾£") && bannedTags.includes("è¾£")) {
                resultTags.innerHTML = "æ—¢æƒ³åƒè¾£åˆä¸æƒ³åƒè¾£ï¼Ÿ";
            } else {
                resultTags.innerHTML = "ç­›é€‰å¤ªä¸¥å•¦ï¼Œæ”¾å®½ç‚¹æ¡ä»¶å§";
            }
            return;
        }

        // å»é‡æŠ½å–
        let finalDish;
        if (safeList.length === 1) {
            finalDish = safeList[0];
        } else {
            let attempts = 0;
            do {
                const randomIndex = Math.floor(Math.random() * safeList.length);
                finalDish = safeList[randomIndex];
                attempts++;
            } while (finalDish.name === lastDishName && attempts < 10);
        }
        lastDishName = finalDish.name;

        // 5. åŠ¨ç”»å±•ç¤º
        let count = 0;
        const interval = setInterval(() => {
            const tempIndex = Math.floor(Math.random() * safeList.length);
            resultName.style.color = "#999";
            resultName.innerText = safeList[tempIndex].name;
            count++;
            
            if (count >= 10) {
                clearInterval(interval);
                resultName.style.color = "#2c3e50";
                resultName.innerText = finalDish.name;
                
                // æ¸²æŸ“æ ‡ç­¾
                const tagsHtml = finalDish.tags.map(t => {
                    let className = 'tag-pill';
                    // å¦‚æœè¿™ä¸ªtagæ˜¯ä½ åˆšæ‰ç‚¹çš„â€œæƒ³åƒâ€çš„ï¼Œé«˜äº®æ˜¾ç¤º
                    if (cravings.includes(t)) className += ' highlight';
                    // å¦‚æœæ˜¯é£é™©è¿‡æ•åŸï¼Œæ ‡çº¢
                    if (["è¾£", "éº¸è´¨", "é¸¡è›‹", "ç”Ÿé£Ÿ", "å†…è„"].includes(t)) className += ' warn';
                    return `<span class="${className}">${t}</span>`;
                }).join('');
                resultTags.innerHTML = tagsHtml;
            }
        }, 50);
    }
</script>

</body>
</html>